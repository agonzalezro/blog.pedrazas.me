<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Docker &middot; Big Bag Blog</title>

    <meta name="description" content="Need a place to hide">

    <meta name="generator" content="Hugo 0.14" />
    <meta name="twitter:card" content="summary">
    
    <meta name="twitter:title" content="Docker &middot; Big Bag Blog">
    <meta name="twitter:description" content="Need a place to hide">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Docker &middot; Big Bag Blog">
    <meta property="og:description" content="Need a place to hide">

    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Oxygen:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-old-ie-min.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">
    <!--<![endif]-->

    <link rel="stylesheet" href="http://blog.pedrazas.me/css/all.min.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="alternate" type="application/rss+xml" title="Big Bag Blog" href="http://blog.pedrazas.me/index.xml" />
</head>
<body>


<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
    <div class="header">
        <hgroup>
            <h1 class="brand-title"><a href="http://blog.pedrazas.me">Big Bag Blog</a></h1>
            <h2 class="brand-tagline"> Need a place to hide </h2>
        </hgroup>

        <nav class="nav">
            <ul class="nav-list">
                
                <li class="nav-item">
                    <a class="pure-button" href="https://twitter.com/ipedrazas"><i class="fa fa-twitter"></i> Twitter</a>
                </li>
                
                
                <li class="nav-item">
                    <a class="pure-button" href="https://github.com/ipedrazas "><i class="fa fa-github-alt"></i> github</a>
                </li>
                
                <li class="nav-item">
                    <a class="pure-button" href="http://blog.pedrazas.me/index.xml"><i class="fa fa-rss"></i> rss</a>
                </li>
            </ul>
        </nav>
    </div>
</div>


    <div class="content pure-u-1 pure-u-md-3-4">
        <div>
            
            <div class="posts">
                
                <h1 class="content-subhead">25 Aug 2015</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="http://blog.pedrazas.me/2015/08/25/spaghetti-management/" class="post-title">Spaghetti management</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">ipedrazas</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-DevOps" href="http://blog.pedrazas.me/categories/devops">DevOps</a><a class="post-category post-category-Docker" href="http://blog.pedrazas.me/categories/docker">Docker</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>During a job interview they started asking questions about microservices and the discussion that we had made me think that it would be good to write a bit about it.</p>

<p>Microservices are great because:</p>

<ul>
<li>They are small, that&#8217;s why the appended &#8220;<em>Micro</em>&#8220;</li>
<li>They are independent one each other (deployment, runtime, configuration, downtime, scaling&#8230;)</li>
</ul>

<p>Great! so, where&#8217;s the catch&#8230; because there&#8217;s always a catch. Think about it. You can split your API in multiple microservices. Great, now, the application is loosely coupled to a bunch of services.</p>

<p>If you replace services by libraries, the name that comes to your mind is? DEPENDENCIES!</p>

<p>The catch with microservices is that dependencies are not implicit in your API or APP the way they used to be (think jars, gems or python libs).</p>

<p>Bear in mind as well that IDE&#8217;s and compilers are very good (in general) at finding when dependencies are broken&#8230; which is not the case if you have a bunch of loosely couple services.</p>

<p>Who&#8217;s responsible for managing all those dependencies now? because excuse me, but I need a way to bundle services together. Or, to be more precise, to bundle versions of services together.</p>

<p>To me the hardest problem is not a design problem, the hardest problem is managing dependencies at version level.</p>

<p>At <a href="https://import.io/" title="Import.io">Import.io</a> we started moving towards this architecture and the way we solved it was not using service discovery but using the old idea of having a contract where you specify a bunch of versions that you know they play nicely together.</p>

<p>I always differentiate Runtime, Configuration and Context. In our case, Runtime was a container running a microservice. Configuration was another container (a data container) where the relationship between versions was explicitly defined, like a manifest.</p>

<p>The advantage of using a data container to bind a bunch of versions is that you have traceability. You know always how the application was configured, because it is true, with microservices we have gained a lot of flexibility but we have lost certain control. Using a container helps me to regain that control.</p>

<p>Why do I do this? because I can leverage my continuous integration pipeline to test my services and how they interact with each other according to specific versions. Because now, my microservice bundles are in git and not in some obscure key of zookeeper or consul. Even more, when the time to migrate to <a href="http://kubernetes.io/">Kubernetes</a> arrives, I can use my data container as my pod blueprint.</p>

<p>Because one thing is my architecture and another different thing is my runtime and my operations.</p>

<p>Remember&#8230;</p>

<blockquote>
<p><strong>It&#8217;s not about power, it&#8217;s about responsibility</strong></p>
</blockquote>

                    </div>
                </section>
                
                <h1 class="content-subhead">01 Apr 2015</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="http://blog.pedrazas.me/2015/04/01/docker-in-the-enterprise/" class="post-title">Docker in the Enterprise</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">ipedrazas</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-DevOps" href="http://blog.pedrazas.me/categories/devops">DevOps</a><a class="post-category post-category-Docker" href="http://blog.pedrazas.me/categories/docker">Docker</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>One of the top questions that people ask me about Docker is by far &#8220;<strong><em>Do you think the Enterprise will use Docker?</em></strong>&#8221;</p>

<p>My answer has been the same since the very beginning: <strong>Absolutely!</strong></p>

<p>It doesn&#8217;t mean it will happen soon, but it will happen. There&#8217;s just a few layers of middle management and hundreds of scared sysadmins in between, but it will happen.</p>

<p>I&#8217;ve migrated a few legacy enterprise applications to Docker and to me, there&#8217;s a big difference between startups using Docker and classic enterprise companies using Docker. To begin with, big enterprise companies are project and program based instead of product based. Middle management, red tape and a very low speed in general. In the technical aspects there are big differences also.Â Let me give you a couple of examples:</p>

<ul>
<li>Firewalls.</li>
<li>Legacy applications.</li>
</ul>

<p>Have you heard about Mesos? Docker Swarm? the ability to move containers around? well, let me tell you something, in the enterprise we have firewall rules. Firewall rules are dependant on the application but bound to the host. This means that you cannot move containers around if you cannot update firewall rules at the same time.</p>

<p>Solutions like Weave are perfect for this problem. Right now, I&#8217;m not sure how Docker is going to solve the networking aspect, so, I will not say that Docker will do it natively. Still, you get the point.</p>

<p>Another scary issue is &#8220;Legacy Applications&#8221;. Let&#8217;s face it, technical debt is bad, forgotten technical debt is pure evil. Moving these kind of applications into containers is sometimes harder than rewriting them from scratch. Issues that I&#8217;ve found while migrating legacy applications to containers can be split in two main groups:</p>

<ul>
<li>Configuration issues like

<ul>
<li>hard coded url and/or domains: quite typical to see hardcoded jdbc connections. You can get around it using internal DNSs or if in case of major trouble, a reverse proxy.</li>
<li>Hard coded IPs: If you&#8217;re lucky, again, Weave can give you a bit of air here.</li>
<li>Embedded credentials: hardcoding credentials is bad, but including these credentials inside of your binaries is terrible. Bad news is that it happens more often than you think. Yes, they used properties files, and yes, they put that file inside a jar, inside a war, inside an EAR&#8230; Hey, enterprise all the way down!</li>
</ul></li>
<li>Context Issues:

<ul>
<li>The system needs to run in a specific host with a specific configuration like specific IPs (ugh), specific URLs (easy), specific OS (this one was very painful)</li>
</ul></li>
</ul>

<p>Good news is that you have the tools to work around all these issues, and yes, you get much better on fixing them (with time, experience and tears). I don&#8217;t think that we will be seeing a &#8220;Wizard&#8221; to migrate your apps to Docker just yet but we will get there.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">24 Mar 2015</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="http://blog.pedrazas.me/2015/03/24/2nd-docker-birthday-the-london-way/" class="post-title">2nd Docker Birthday, the London Way</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">ipedrazas</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-Docker" href="http://blog.pedrazas.me/categories/docker">Docker</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p><a href="http://ivan.pedrazas.me/wp-content/uploads/2015/03/CAy0qK3UYAA58Oj.jpg"><img class="alignright size-medium wp-image-415" src="http://ivan.pedrazas.me/wp-content/uploads/2015/03/CAy0qK3UYAA58Oj-300x300.jpg" alt="CAy0qK3UYAA58Oj" width="300" height="300" /></a>Last night at Skillsmatter we celebratedDocker&#8217;s 2nd birthday. It was a good evening to catch up with friends and of course, a great opportunityÂ to meet new people.</p>

<p>As usual with Docker, the swag was top notch. The mentor&#8217;s t-shirt was especially awesomic!</p>

<p>Beers and pizza drove to a quick intro by <a href="https://twitter.com/bfirsh">Ben</a> from docker (<a href="https://twitter.com/bfirsh">@bfirsh</a>)Â who explained that that was not yet-another-meetup but what he called an &#8220;OpenSource-a-thon&#8221;. The idea is to get around the table together and contribute to the Docker project. He emphasized that not only code contributions were welcomed, but all sorts of non-code contributions too.</p>

<p>I teamed up with the fine people of <a href="http://www.cloud66.com/">Cloud66</a> trying to sort out the Documentation. We tried to complete <a href="https://github.com/docker/docker/issues/11593">the Issue 11593</a>, but we didn&#8217;t get too far. By the time we had set up the environment and started digging the code, it was time to wrap up.<img class=" size-medium wp-image-420 aligncenter" src="http://ivan.pedrazas.me/wp-content/uploads/2015/03/ben-docker-300x225.jpg" alt="ben-docker" width="300" height="225" /></p>

<p>Documentation is key to adoption. Unfortunately, code documentation is very hard unless you know the code very well. At this pointÂ I would encourage you, kind reader, to try to write a little about something that&#8217;s it&#8217;s itching you. There&#8217;s nothing like sitting down and starting to type (unless you have one of those funky standing desks, of course) to make you realise how hard is to write good documentation.<a href="http://ivan.pedrazas.me/wp-content/uploads/2015/03/stickers-docker.jpg"><img class="alignright size-medium wp-image-419" src="http://ivan.pedrazas.me/wp-content/uploads/2015/03/stickers-docker-300x225.jpg" alt="stickers-docker" width="300" height="225" /></a></p>

<p>Kudos from me to all the people writing documentation. Me and my children are very very pleased with your work. Keep it up!</p>

<p>Docker has a <a href="http://docker.party/">Docker.party</a> website about the motivation behind the &#8220;<em>open-source-a-thon</em>&#8221; where they explain that they will donate $50 to the <a href="http://www.oceanicsociety.org/">Oceanic Society</a> for each contribution we submit during the birthday. You see? write some documentation, save a whale!</p>

<p>But wait, it&#8217;s not only during these events that your contributions can save a whale: from 23rd of March to 19th of April, allÂ contributions made to the Docker Project will count toward Dockerâs donation to the Oceanic Society <strong>\o/</strong></p>

<p>I might spend some time finishing off that issue and to lead as example, I&#8217;m also happy to write a tutorial. I&#8217;ve been running Docker in production for almost a year now, I&#8217;ve built microservices, used Weave, and migrated dinosaurs (aka Big Enterprise Legacy Applications) to containers. So, I might say it&#8217;s safe to think I know a bit about how to use containers in real life scenarios.</p>

<p><a href="https://docs.google.com/forms/d/1R7T-UDsOHsZ9uBYy9YopVEajjPbMrc1cP_nQinfbctc/viewform">Fill this form</a> or Â <a href="https://twitter.com/ipedrazas">Just let me know in Twitter</a>Â what kind of tutorial would you like to see and I will get my hands into it!</p>

<p><strong>Happy Birthday, Docker!</strong></p>

                    </div>
                </section>
                
                <h1 class="content-subhead">02 Nov 2014</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="http://blog.pedrazas.me/2014/11/02/asistentes-a-mi-taller-pycones-2014/" class="post-title">Asistentes a mi taller â PyCoNes 2014</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">ipedrazas</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-Docker" href="http://blog.pedrazas.me/categories/docker">Docker</a><a class="post-category post-category-Spanish" href="http://blog.pedrazas.me/categories/spanish">Spanish</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Si aÃºn no tienes claro si vas a venir a mi taller o no, <a href="http://ivan.pedrazas.me/?p=364">lee esto</a>, y luego sigue <img src="http://ivan.pedrazas.me/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley" /></p>

<p>Parece que la conexiÃ³n de internet no va a ser para tirar cohetes&#8230; nada que no hayamos sufrido todos alguna vez. AsÃ­ que, para minimizar el impacto de una mala conexiÃ³n hay dos opciones:</p>

<p>Usar una conexion ssh a una mÃ¡quina virtual en la nube (AWS, <a href="https://www.digitalocean.com/?refcode=56ae0600c4bc">Digital Ocean</a>, Linode&#8230; o vuestro proveedor de mÃ¡quinas virtuales favorito). Con Ã©sto conseguimos que el trÃ¡fico ocurra entre esa mÃ¡quina y docker, limitando el trÃ¡fico desde la sala a un puÃ±ado de conexiones ssh.</p>

<p>Otra opciÃ³n es usar vuestro ordenador y descargar antes las imÃ¡genes que se van a usar. Ãsta opciÃ³n es mÃ¡s agresiva con la red por que cuando hagamos un build habrÃ¡ imÃ¡genes que no se cachearÃ¡n y habrÃ¡ que descargarlas&#8230; y petaremos la red.</p>

<p>Si vÃ¡is a usar vuestro ordenador, es recomendable que os instalÃ©is la versiÃ³n 1.3 de docker y hagÃ¡is pull de las siguientes imÃ¡genes. En negrita estÃ¡n las 5 imÃ¡genes base para desarrollo python:</p>

<p><strong>docker pull ubuntu</strong></p>

<p>docker pull tpires/neo4j</p>

<p><strong>docker pull dockerfile/redis</strong></p>

<p>docker pull dockerfile/mongodb</p>

<p>docker pull ipedrazas/elasticsearch</p>

<p>docker pull poklet/cassandra</p>

<p><strong>docker pull python:2</strong></p>

<p><strong>docker pull python:3</strong></p>

<p>docker pull nornagon/postgres</p>

<p>docker pull clue/ttrss</p>

<p><strong>docker pullÂ postgres</strong></p>

<p>docker pull ipedrazas/taiga-front</p>

<p>docker pull ipedrazas/taiga-back</p>

<p>docker pullÂ php:5.6-apache</p>

<p>docker pull node:0.10-onbuild</p>

<p>La lista no es definitiva, pero cubre mucho camino. A los que no usÃ©is Linux, tenÃ©is que instalar Boot2Docker y si no recuerdo mal, la versiÃ³n 1.3 ya permite montar volÃºmenes entre host y contenedor, asÃ­ que no tendrÃ©is problemas para seguir el taller.</p>

<p>Si tenÃ©is preguntas o querÃ©is que hable de algÃºn tema en concreto, mandadme un email, o dadme un toque por <a href="https://twitter.com/ipedrazas">twitter</a>.</p>

<p>El taller estÃ¡ pensado para que la gente salga con una idea clara de lo que se puede hacer con Docker y por donde se puede empezar. Todo el material estarÃ¡ colgado en github.</p>

<p>Nos vemos el SÃ¡bado!</p>

<p><strong>Nota</strong>: ya empezamos otra vez con las notitas?</p>

<p><strong>Nota 2</strong>: No, el cÃ³digo de DO no es por que &#8220;espere forrarme&#8221;, ni mucho menos. Â O sea, en serio??</p>

<p><strong>Nota 3</strong>: a ver cuÃ¡ntos errores y tildes encuentra <a href="https://twitter.com/yamila_moreno">Yamila</a>&#8230;</p>

<p>Nota 4: Gracias a <a href="https://twitter.com/agonzalezro">Ãlex</a> por corregirme 723 errores, lo menos <img src="http://ivan.pedrazas.me/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley" /></p>

                    </div>
                </section>
                
                <h1 class="content-subhead">30 Oct 2014</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="http://blog.pedrazas.me/2014/10/30/pycones-2014/" class="post-title">PyConEs 2014</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">ipedrazas</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-Docker" href="http://blog.pedrazas.me/categories/docker">Docker</a><a class="post-category post-category-Spanish" href="http://blog.pedrazas.me/categories/spanish">Spanish</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Estoy muy orgulloso de poder participar en la PyCon EspaÃ±ola con un taller que para seguir la tradiciÃ³n he titulado Â &#8220;<strong>50 Shades of Docker</strong>&#8220;.</p>

<p>El taller es una breve introducciÃ³n a los contenedores de Linux y por quÃ© es importante saber sobre ellos. Si eres CIO, CEO o Director de InformÃ¡tica de una empresa donde se usa la virtualizaciÃ³n, Ã©ste es un taller que no te puedes perder!!!</p>

<p>De hecho, si eres programador, sysadmin o diseÃ±ador&#8230; tampoco te puedes perder!</p>

<p>Si te preguntÃ¡s por quÃ© deberÃ­as pagar <del><a href="https://www.ticketea.com/pycones14/">los 30â¬ de la entrada</a></del>Â (<a href="https://www.ticketea.com/pycones14/">20â¬ usando el codigo <strong>DescuentoPonentes</strong>)</a> de la PyConEs, la respuesta es muy sencilla: lo que te vas a ahorrar una vez entiendas lo que Docker puede hacer para ti o tu negocio va a compensar muy mucho el precio de la entrada.</p>

<p>El taller esta orientado de forma genÃ©rica. Los conceptos, si bien son un poco abstractos y con poca aplicaciÃ³n prÃ¡ctica, dan paso a multitud de soluciones y prÃ¡cticas que se resumen en una frase muy corta:</p>

<p>&#8220;trabajar mejor&#8221;</p>

<p>AsÃ­ que si estÃ¡s interesado en saber o aprender cÃ³mo puedes trabajar mejor.. ya sabes, VEN!</p>

<p>Durante el taller se mostrarÃ¡n ejemplos prÃ¡cticos. Como todo el mundo ha padecido alguna vez, durante las conferencias la conexiÃ³n a Internet sufre bastante, es por eso que se recomienda a los asistentes que usen una conexiÃ³n remota (con <a href="https://www.digitalocean.com/?refcode=56ae0600c4bc">Ã©ste cÃ³digo</a> puedes obtener <a href="https://www.digitalocean.com/?refcode=56ae0600c4bc">$10 gratis</a> en Digital Ocean, mÃ¡s que suficiente para que cada asistente pueda realizar el taller durante un par de meses).</p>

<p>Si prefieres usar tu ordenador, deberÃ¡s asegurarte que tienes la Ãºltima versiÃ³n de <a href="https://docs.docker.com/installation/#installation">Docker instalada</a>, y una vez la tengas instalada, ejecuta el setup.sh que hay en el repositorio de mi github.</p>

<p>&nbsp;</p>

<p><strong>Nota</strong>: estoy montando el repo durante esta semana, asÃ­ que no te sorprendas que el setup cambie un poquillo</p>

<p><strong>Nota 2</strong>: El setup lo Ãºnico que hace es bajarse las imÃ¡genes que usaremos durante el taller.</p>

<p><strong>Nota 3</strong>: SÃ­, voy a traer mis Google Glass, pero si vienes a mi taller por unas gafas sin cristales tÃº y yo tenemos que hablar!</p>

<p><strong>Nota 4</strong>: cualquier duda, <a href="https://twitter.com/ipedrazas">pregunta</a>!</p>

<p><strong>Nota 5</strong>: si la duda es de <a href="https://golang.org/">Golang</a>, preguntadle a <a href="https://twitter.com/agonzalezro">Alex</a>!</p>

<p><strong>Ãltima Nota</strong>: El <a href="https://twitter.com/juanriaza">maestro Riaza</a> se ha comprometido a llevarme a comer a un lugar &#8220;secreto&#8230; dice&#8221; que va a superar con creces la comida de la pasada PyCon. Como dicen por aqui: really looking forward to eating there <img src="http://ivan.pedrazas.me/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley" /></p>

                    </div>
                </section>
                
                <h1 class="content-subhead">08 Oct 2014</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="http://blog.pedrazas.me/2014/10/08/local-taiga-with-docker/" class="post-title">Local Taiga with Docker</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">ipedrazas</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-Docker" href="http://blog.pedrazas.me/categories/docker">Docker</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Recently <a href="https://taiga.io/">Taiga.io</a> was announced. As they describe themselves:</p>

<blockquote>
<p>Free. Open Source. Powerful. <strong>Taiga</strong> is a project management platform for startups and agile developers &amp; designers who want a simple, <strong>beautiful</strong> tool that makes work truly enjoyable.</p>
</blockquote>

<p>It didn&#8217;t take me too long to realise that it would be a nice preparation to dockerize taiga for my next &#8220;50 Shades of Docker&#8221; workshop at the Spanish PyCon.</p>

<p>I have to reckon that it&#8217;s been more challenging than expected. I would blame the developers, of course  <img src="http://ivan.pedrazas.me/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley" />but truth is that turning taiga into a docker container is quiet simple (specially since they provide all the scripts to build a taiga platform in one single host).</p>

<p>Unfortunately for me, I like distributing things&#8230; so I decided to run one single process per container, so I would have several containers.</p>

<p>The scripts installed Redis and RabbitMQ which are not in use (just yet), so teh final version hasÂ 3 containers:</p>

<ul>
<li>Postgres</li>
<li><del>RabbitMQ</del></li>
<li><del>Redis</del></li>
<li>Taiga-back</li>
<li>Taiga-front</li>
</ul>

<p>Another problem I found is that the front-end is not distributable. It means, you have to build it&#8230; so, I created another container that does the build.</p>

<p>If you want to run taiga in your local machine, you can do so by using this script:</p>

<pre>sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 36A1D7869245C8950F966E92D8576A8BA88D21E9
sudo sh -c "echo deb https://get.docker.io/ubuntu docker main &gt; /etc/apt/sources.list.d/docker.list"
sudo apt-get update -y
sudo apt-get install -y lxc-docker

sudo mkdir -p /data/postgresql

sudo docker run -d --name postgres    -p 5432:5432  -v /data/postgresql:/var/lib/postgresql/data postgres
sudo docker run -d --name taiga-back  -p 8001:8001  --link postgres:postgres ipedrazas/taiga-back
sudo docker run -d --name taiga-front -p 80:80 -p 8000:8000 --link taiga-back:taiga-back ipedrazas/taiga-front


sudo docker run -it --link postgres:postgres --rm postgres sh -c "su postgres --command 'createuser -h "'$POSTGRES_PORT_5432_TCP_ADDR'" -p "'$POSTGRES_PORT_5432_TCP_PORT'" -d -r -s taiga'"
sudo docker run -it --link postgres:postgres --rm postgres sh -c "su postgres --command 'createdb -h "'$POSTGRES_PORT_5432_TCP_ADDR'" -p "'$POSTGRES_PORT_5432_TCP_PORT'" -O taiga taiga'";
sudo docker run -it --rm --link postgres:postgres ipedrazas/taiga-back bash regenerate.sh
</pre>

<p>If, like me, you want to run it in AWS or Digital Ocean, you will need first to create a DNS and build Taiga using that host (yes, the api url is hardcoded&#8230; so, you have to build it using your hostname).</p>

<p>Having said that, I want to congratulate the whole Taiag team for the product and the support they have been giving (not only to me, but to many others). <strong>Well done, guys!</strong></p>

<p>All theÂ code is in my <a href="https://github.com/ipedrazas/taiga-docker">Github Repo</a>, in case that anyone wants to play with it. If you have any doubts, <a href="https://twitter.com/ipedrazas">just ask</a> <img src="http://ivan.pedrazas.me/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley" /></p>

                    </div>
                </section>
                
                <h1 class="content-subhead">18 Sep 2014</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="http://blog.pedrazas.me/2014/09/18/cassandra-and-docker-round-1/" class="post-title">Cassandra and Docker â round 1</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">ipedrazas</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-Cassandra" href="http://blog.pedrazas.me/categories/cassandra">Cassandra</a><a class="post-category post-category-Docker" href="http://blog.pedrazas.me/categories/docker">Docker</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p><a href="http://ivan.pedrazas.me/wp-content/uploads/2014/09/Cassandra_logo.svg_.png"><img class="aligncenter size-medium wp-image-340" src="http://ivan.pedrazas.me/wp-content/uploads/2014/09/Cassandra_logo.svg_-300x201.png" alt="Cassandra_logo.svg" width="300" height="201" /></a></p>

<p>&nbsp;</p>

<p>This last week I&#8217;ve spent some time trying to set up Cassandra in Docker. My starting point was this Docker Image called <a href="https://registry.hub.docker.com/u/poklet/cassandra/">pokle/cassandra</a>.</p>

<p>There are things from that image that I don&#8217;t like and I&#8217;ve been very tempeted to fork it, but as I said, it was a starting point, and for what we need now, it&#8217;s good enough.</p>

<p>Basically what I wanted was to have a cluster of 3 machines running in Docker, talking to each other and letting me &#8220;play away&#8221;.</p>

<p>I&#8217;m re-writing dotMarks in java using Dropwizard and, of course, Cassandra. Anyway, this post is about how to set up that cluster.</p>

<p>Open your terminal and paste this:</p>

<pre># Make dirs to store your data
sudo mkdir -p /data/cassandra/{c1,c2,c3}/data
sudo mkdir -p /data/cassandra/{c1,c2,c3}/commitlog

# Change permissions so the Cassandra user can write on them
sudo chmod 777 /data/cassandra/{c1,c2,c3}/data
sudo chmod 777 /data/cassandra/{c1,c2,c3}/commitlog

# Run the Docker containers with Cassandra
docker run -d --name c1 -v /data/cassandra/c1/data:/var/lib/cassandra/data -v /data/cassandra/c1/commitlog:/var/lib/cassandra/commitlog poklet/cassandra
docker run -d --name c2 -v /data/cassandra/c2/data:/var/lib/cassandra/data -v /data/cassandra/c2/commitlog:/var/lib/cassandra/commitlog poklet/cassandra start $(./scripts/ipof.sh c1)
docker run -d --name c3 -v /data/cassandra/c3/data:/var/lib/cassandra/data -v /data/cassandra/c3/commitlog:/var/lib/cassandra/commitlog poklet/cassandra start $(./scripts/ipof.sh c1)

# Open a CQLSH console
docker run -it --rm --link c1:c1 -v /data/cassandra/scripts:/data poklet/cassandra bash -c 'cqlsh $C1_PORT_9160_TCP_ADDR'

</pre>

<p>Now you should have a C* cluster of 3 containers. Run docker ps and you should see something like this:</p>

<p>&nbsp;</p>

<pre>-&gt; % docker ps
CONTAINER ID        IMAGE                     COMMAND               CREATED              STATUS              PORTS                                                                           NAMES
f85542cb46e3        poklet/cassandra:latest   "start 172.17.0.14"   About a minute ago   Up About a minute   8012/tcp, 9042/tcp, 9160/tcp, 22/tcp, 61621/tcp, 7000/tcp, 7001/tcp, 7199/tcp   c3                  
9cfdccaf1213        poklet/cassandra:latest   "start 172.17.0.14"   About a minute ago   Up About a minute   9160/tcp, 22/tcp, 61621/tcp, 7000/tcp, 7001/tcp, 7199/tcp, 8012/tcp, 9042/tcp   c2                  
162c36a8b876        poklet/cassandra:latest   "/bin/sh -c start"    2 minutes ago        Up 2 minutes        9042/tcp, 9160/tcp, 22/tcp, 61621/tcp, 7000/tcp, 7001/tcp, 7199/tcp, 8012/tcp   c1    
</pre>

<p>Now, you might want to add some data. We do that using another container that will execute <em><strong>CQLSH</strong></em>.</p>

<pre>docker run -it --rm --link c1:c1 -v /data/cassandra/scripts:/data poklet/cassandra bash -c 'cqlsh $C1_PORT_9160_TCP_ADDR'
</pre>

<p>Note that by using Links you don&#8217;t need to know the IPs of the nodes. We will need them to connect if we don&#8217;t use a container with links, but let&#8217;s see that problem later.</p>

<p>Once you are in the CQLSH, add some data:</p>

<pre>CREATE KEYSPACE dotmarks WITH REPLICATION =
 {'class': 'SimpleStrategy', 'replication_factor': 1};

 USE dotmarks;

 CREATE TABLE test_table (
  id text,
  test_value text,
  PRIMARY KEY (id)
 );


INSERT INTO test_table (id, test_value) VALUES ('1', 'one');
INSERT INTO test_table (id, test_value) VALUES ('2', 'two');
INSERT INTO test_table (id, test_value) VALUES ('3', 'three');

SELECT * FROM test_table;
</pre>

<p>If you want to check the data from a different node, do this:</p>

<pre>docker run -it --rm --link c2:c2 -v /data/cassandra/scripts:/data poklet/cassandra bash -c 'cqlsh $C2_PORT_9160_TCP_ADDR'


Connected to Test Cluster at 172.17.0.15:9160.
[cqlsh 4.1.1 | Cassandra 2.0.9 | CQL spec 3.1.1 | Thrift protocol 19.39.0]
Use HELP for help.
cqlsh&gt; use dotmarks;
cqlsh:dotmarks&gt; select * from test_table;

 id | test_value
----+------------
  3 |      three
  2 |        two
  1 |        one

(3 rows)

cqlsh:dotmarks&gt; 
</pre>

<p>With this, we have our cluster ready to rock and roll! In the next post, we will see how to confdigure and connect our Dropwizard App to our Cassandra cluster.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">22 Aug 2014</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="http://blog.pedrazas.me/2014/08/22/how-to-build-microservices-in-java-without-losing-your-sanity/" class="post-title">How to build (and run) Microservices in Java without losing your Sanity</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">ipedrazas</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-Development" href="http://blog.pedrazas.me/categories/development">Development</a><a class="post-category post-category-Docker" href="http://blog.pedrazas.me/categories/docker">Docker</a><a class="post-category post-category-Java" href="http://blog.pedrazas.me/categories/java">Java</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>If you haven&#8217;t heard about Microservices, <a href="http://martinfowler.com/articles/microservices.html">go here</a> and read about them!</p>

<p>For a long time I&#8217;ve writen all my microservices using Python because Java had a massive overhead (called a Servlet Container).</p>

<p>I&#8217;m not sure how I stumbled upon DropWizard, but it has done something that I thought impossible: My Ops side has loved Java back.</p>

<p>What do I want?</p>

<p>I want to be able to define a simple REST service and publish it with as little dependencies as possible.</p>

<p>Yes, I can write a JAX-RS class and run:</p>

<pre>-&gt;%mvn jetty:run
</pre>

<p>And my servlet container will expose my REST service&#8230; but let&#8217;s face it, deploying services like this will not take us too far. Like, are you planning to run a Jetty/Tomcat service per MicroService you want to expose??? Yes, this is where my Ops side of me was cringing big time.</p>

<p>True, I could bundle services and&#8230; and little by little we will find ourselves walking away from our beloved Microservices because of &#8220;Operations is complicated&#8221;. Operations is hard, we all know that, but a good architecture has to provide enough tools to satisfy our design goals without compromise our operations.</p>

<p>Solution? I&#8217;m sure It won&#8217;t surprise any of my followers: it&#8217;s to useÂ <strong>Docker and&#8230; DropWizard</strong>!!!</p>

<p>How, you don&#8217;t know <a href="https://dropwizard.github.io">DropWizard</a>? run to their website and sort that out: NOW! DropWizard does a lot of things, one of them is awesome: It allows you to write a JAX-RS class and run it from your command line. I mean, it creates a fat jar file that you can then run:</p>

<pre>java -jar my_microservice-0.0.1-SNAPSHOT.jar server my_microservice_conf.yml
</pre>

<p>And&#8230; itÂ will expose your rest service in the port 8080 (and it comes with an admin freebie in port 8081 &lt;&#8211; my ops side of me is very happy about this).</p>

<p>Now&#8230; what happens if you build a Docker image that runs that instruction? That you have an easy way to run/test/distribute your microservice.</p>

<pre>sudo docker run -d -p 9094:8080 7887:8081 ipedrazas/m_dotmarks:latest
</pre>

<p>Note that all my microservices are exposed using the default ports: 8080 and 8081 and then I re-map them when running them in Docker. Why? because it gives me more flexibility and I don&#8217;t have to worry about Ops while doing Dev (yes, developers do not decide how to run the service).</p>

<p>As always, I strongly recommend to run nginx as a gateway to your dockerized services. In this case our two ports 8080 and 8081 will be remmaped to 9094 (that nginx will expose using a url like api.dotmarks.net/dotmarks) and 7887 that will be used internally only.</p>

<p>These holidays I&#8217;ve been rewriting my <a href="https://dotmarks.net/">dotMarks</a> app originally in python in Java using DropWizard and I will be releasing the code once it works.</p>

<p>Stay tunned!</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">18 Jun 2014</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="http://blog.pedrazas.me/2014/06/18/ditto-docker/" class="post-title">Thoughts on Docker</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">ipedrazas</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-Docker" href="http://blog.pedrazas.me/categories/docker">Docker</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p><a href="http://ivan.pedrazas.me/wp-content/uploads/2014/06/docker-logo.png"><img class="aligncenter size-full wp-image-237" src="http://ivan.pedrazas.me/wp-content/uploads/2014/06/docker-logo.png" alt="docker logo" width="400" height="400" /></a></p>

<p>&nbsp;</p>

<blockquote>
<p><span style="font-style: italic; color: #574d4d;">Docker is an open-source project to easily create lightweight, portable, self-sufficient containers from any application</span></p>
</blockquote>

<div id="wmd-preview-section-3" class="wmd-preview-section preview-content" style="color: #162029;">
  <h3 id="vagrant">
    Vagrant
  </h3>
  
  <p>
    Itâs not a secret that <a href="http://www.vagrantup.com/" target="_blank">Vagrant</a> changed my life as a developer.Â I&#8217;m sure that if you know me, you will have heard me talking about how great vagrant is.
  </p>
  
  <p>
    Vagrant, in case that you donât know, itâs a little tool that allows you to develop locally an execute your code inside a Virtual Machine. This, of course, gives you the advantage of not needing to setup your own machine (a painful activity that we all have been suffering in silence for years). In a nutshell, vagrant helps you to decouple your development environment from your workstation.
  </p>
</div>

<div id="wmd-preview-section-4" class="wmd-preview-section preview-content" style="color: #162029;">
  <h3 id="after-vagrant">
    After Vagrant
  </h3>
  
  <p>
    Now, we cannot say that thereâs a new guy in the block, because <a href="https://www.docker.com" target="_blank">Docker</a> has been around for a while (ehemâ¦) but we do can say that Docker is not only going to change my life but itâs about to change everyoneâs life.
  </p>
  
  <p>
    <strong>Docker will change the way we run and distribute applications.</strong>
  </p>
  
  <p>
    I donât think Iâm the right person to explain what Docker is. I can tell you how it has changed the way I work, or to put it differently, to change the things I do, butÂ if you really want to understand how Docker works, it&#8217;s better you look at the resources at the bottom of the page.
  </p>
</div>

<div id="wmd-preview-section-5" class="wmd-preview-section preview-content" style="color: #162029;">
  <div class="se-section-delimiter">
  </div>
  

<p><h3 id="enter-docker">
    Enter Docker
  </h3></p>

<p><p>
    Docker is a linux container that allows you to run an application with a simple &#8220;RUN&#8221; command. Yes, there are a few other parameter but the idea is that you can launch an app (that it&#8217;s self contained) with a single command.
  </p></p>

<p><p>
    If you haven&#8217;t suffered the enlighting experience of trying to run a web application like WordPress, for example, you don&#8217;t know how complex things can turn very quickly. The ammount of software and things that have to be &#8220;in place&#8221; and configured properly is painful. How Docker can help you there? well, someone, for example me, will spend some time building a Docker image so people like you can just run it with a simple command.
  </p></p>

<p><p>
    Docker will lower the sys admin barrier. People who doesn&#8217;t know much about how to set up a web server suddenly can run their own wordpress instance (which is the idea behind of all those VPS with &#8220;one-click install&#8221;).
  </p></p>

<p><p>
    But there&#8217;s more, with Docker creating a cluster itâs easy. Ok, not trivial, but very feasible. Do you remember those complicated architectures you have seen in books? now you can build them in your laptop. I agree, a cluster under work load behaves very different than a cluster you could run in your workstation, but letâs face it, the fact that you can use docker to build a cluster of machines will help to speed up the future development of applications and solutions.
  </p></p>

<p><p>
    So, what I have been doing with Docker that has changed the way I see things?
  </p></p>

<p><p>
    well, Iâm writing<a href="http://dotmarks.net"> a little tool </a>to manage bookmarks. The App has two provisioning tools. Vagrant (of course) and ansible scripts to deploy and configure the app in a VPS (like <a href="https://www.digitalocean.com/?refcode=56ae0600c4bc">Digital Ocean</a>, for example).
  </p>
</div></p>

<div id="wmd-preview-section-6" class="wmd-preview-section preview-content" style="color: #162029;">
  <h3 id="dotmarks">
    .dotMarks
  </h3>
  
  <p>
    The whole idea of this app is to self-host your bookmarks. Yes, I know, nobody seems to use bookmarks nowadays but that&#8217;s a different story. The idea is that you run it in your machineâ¦ and because of that you can see how Docker can make my life much easier: Itâs like giving people an executable that they can run. Everything is self-contained and pre-configured. Itâs perfect, it&#8217;s Awesome!
  </p>
  
  <h3 id="dotmarks">
    What about me?
  </h3>
  
  <p>
    By default I run 3 docker containers in my machine. One with the <a href="https://github.com/crosbymichael/dockerui" target="_blank">Dockerui</a>Â (A web interface for Docker), <a href="https://registry.hub.docker.com/u/ipedrazas/elasticsearch/">One with ElasticSearch</a> and one with MongoDB. I still use Vagrant to develop and run .dotMarks, but once it&#8217;s ready, I can tell you, it will run in its own docker container.
  </p>
  
  <div id="attachment_240" style="width: 310px" class="wp-caption aligncenter">
    <a href="http://ivan.pedrazas.me/wp-content/uploads/2014/06/Screenshot-from-2014-06-19-004257.png"><img class="aligncenter size-medium wp-image-267" src="http://ivan.pedrazas.me/wp-content/uploads/2014/06/Screenshot-from-2014-06-19-004257-300x97.png" alt="Screenshot from 2014-06-19 00:42:57" width="300" height="97" /></a>
    
    <p class="wp-caption-text">
      Marvel plugin for ElaasticSearch showing the state of my system
    </p>
  </div>
</div>

<div id="wmd-preview-section-7" class="wmd-preview-section preview-content">
  <h3 id="where-do-we-go-from-here" style="color: #162029;">
    Where do we go from here
  </h3>
  
  <p style="color: #162029;">
    Good question. As I see it, there are three areas that are not under the Docker Radar but I think that once the right people understand the potential it will go through as a freight train:
  </p>
  
  <ul style="color: #162029;">
    <li>
      <strong>Education:</strong>Â From the newbies that they need a (safe) playground to land, to the more experienced guy who wants to understand complex architectures, Docker has a huge potential in (self) education.
    </li>
    <li>
      <strong>Application Distribution:</strong>Â WebApps are awesome, but distributing them is quite a painâ¦ in fact, not many people do that because let&#8217;s face it, it&#8217;s hard. Itâs not only shipping the code, it&#8217;s configuring the servers, and running the whole lot andâ¦ itâs complicated. Docker will bring a standard way of distributing applications. From wordpress to the latest trendy idea someone pushes to Github&#8230; I&#8217;m sure developers will start including Dockerfiles to their repos once they understand the wonders of linux containers
    </li>
    <li>
      <strong>Support and Quality Control:</strong>Â Suddenly, testing applications in the real architecture locally is suddenly possible. Do you have customers with your system installed in-house. Replicating their environtment is a matter of linking images in a Dockerfile.
    </li>
  </ul>
  
  <p style="color: #162029;">
    But don&#8217;t get too carried away, Docker has its amaizing Use Cases but it&#8217;s not for everyone. Yes, developers and SysAdmins love it&#8230; time will say if it will become mainstream.
  </p>
  
  <p style="color: #162029;">
    Want to know more? look at these resources:
  </p>
  
  <ul>
    <li>
      <a href="http://www.youtube.com/watch?v=pts6F00GFuU" target="_blank">Docker at Spotify</a>
    </li>
    <li>
      <a href="http://en.wikipedia.org/wiki/Docker_(software)" target="_blank">Docker entry in Wikipedia</a>
    </li>
    <li>
      <a href="https://www.youtube.com/watch?v=ZzQfxoMFH0U" target="_blank">What it&#8217;s Docker</a>
    </li>
    <li>
      <a href="http://www.slideshare.net/fasgoncalves/hypervisor-versus-linux-containers">Future of Aplication Delivery</a>
    </li>
  </ul>
</div>

                    </div>
                </section>
                
            </div>
            

            <div class="footer">
    <div class="pure-menu pure-menu-horizontal pure-menu-open">
        <ul>
            <li>Powered by <a class="hugo" href="http://hugo.spf13.com/" target="_blank">hugo</a></li>
        </ul>
    </div>
</div>
<script src="http://blog.pedrazas.me/js/all.min.js"></script>
        </div>
    </div>
</div>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', '', 'auto');
ga('send', 'pageview');

</script>

</body>
</html>

<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Posts &middot; Big Bag Blog</title>

    <meta name="description" content="Need a place to hide">

    <meta name="generator" content="Hugo 0.14" />
    <meta name="twitter:card" content="summary">
    
    <meta name="twitter:title" content="Posts &middot; Big Bag Blog">
    <meta name="twitter:description" content="Need a place to hide">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Posts &middot; Big Bag Blog">
    <meta property="og:description" content="Need a place to hide">

    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Oxygen:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-old-ie-min.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">
    <!--<![endif]-->

    <link rel="stylesheet" href="http://blog.pedrazas.me/css/all.min.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="alternate" type="application/rss+xml" title="Big Bag Blog" href="http://blog.pedrazas.me/index.xml" />
</head>
<body>


<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
    <div class="header">
        <hgroup>
            <h1 class="brand-title"><a href="http://blog.pedrazas.me">Big Bag Blog</a></h1>
            <h2 class="brand-tagline"> Need a place to hide </h2>
        </hgroup>

        <nav class="nav">
            <ul class="nav-list">
                
                <li class="nav-item">
                    <a class="pure-button" href="https://twitter.com/ipedrazas"><i class="fa fa-twitter"></i> Twitter</a>
                </li>
                
                
                <li class="nav-item">
                    <a class="pure-button" href="https://github.com/ipedrazas "><i class="fa fa-github-alt"></i> github</a>
                </li>
                
                <li class="nav-item">
                    <a class="pure-button" href="http://blog.pedrazas.me/index.xml"><i class="fa fa-rss"></i> rss</a>
                </li>
            </ul>
        </nav>
    </div>
</div>


    <div class="content pure-u-1 pure-u-md-3-4">
        <div>
            
            <div class="posts">
                
                <h1 class="content-subhead">23 Feb 2015</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="http://blog.pedrazas.me/2015/02/23/what-do-i-talk-about-when-i-talk-about-devops/" class="post-title">What do I talk about when I talk about DevOps</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">ipedrazas</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-Uncategorized" href="http://blog.pedrazas.me/categories/uncategorized">Uncategorized</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>I&#8217;ve been in a few meetups already and I&#8217;ve seen people trying to explain &#8220;<em>what is this DevOps thing, anyway</em>&#8220;.</p>

<p>To DevOps you come from Dev&#8230; or from Ops, and that origin is quiet important, not because of what you know, but because how do you do things. Some people see DevOps like a fancy way of saying &#8220;sysadmins&#8221; (recruiters, I&#8217;m looking at you!!). Well, here are the bad news for recruiters: DevOps is more about Dev than Ops&#8230;</p>

<p>DevOps it&#8217;s about making life better for developers and sysadmins. DevOps it&#8217;s not about writing Jenkins job, DevOps is about changing the way your process work so you remove risk and friction from, for example, your Jenkins jobs.</p>

<p>I know, it&#8217;s very unclear&#8230; and I guess that&#8217;s why there&#8217;s so much talk about what it&#8217;s DevOps and what it&#8217;s not.</p>

<p>Because it&#8217;s not about the tools, it&#8217;s not about the process. It&#8217;s about how do we use those tools and implement those processes that creates friction. Talking about friction, DevOps it&#8217;s giving a small blanket to someone who wears chunky boots before throwing himself down a slide.</p>

<p>But why we have so many different definitions, then? because we are a mix and match group of people with a mix and match set of problems and a mix and match of tools in our toolboxes. Plenty of combinations, one objective: delivering.</p>

<p>So, there&#8217;s no silver bullet? I&#8217;m afraid not. The fact that you use Jira and Slack and Git doesn&#8217;t make you an Agile team. It certainly makes your life easier than using Subversion, emails and Microsoft Project, but the tools are not the team, the same way that the team is not the product.</p>

<p>DevOps is not about being a sysadmin, or a developer, it&#8217;s about being able to challenge and change processes and tools. The most important part of being a good DevOps engineer is not being a good developer or a very methodical sysadmin, it&#8217;s about having the vision and the guts to challenge the process, the tools and the teams.</p>

<p>Adding a sysadmin type of person to a group of developers will make that team better. The same way that adding a developer to a group of sysadmins. It&#8217;s about finding balance and complementing each other. It&#8217;s not about using Nagios, of Chef or writing Tests for how your infrastructure is created.</p>

<p>If you google successful DevOps stories you will find many different examples of how to improve. Some of them talk about using a set of tools that allowed them to shorten release times. Others, talk about reorganisations, another will explain how they managed to speed up the communication and feedback loops, or how did they reduce costs, or many others&#8230; The Objective is always the same: Improving you delivery. The pattern is clear: every single successful DevOps story had the opportunity to <strong>challenge the Status Quo</strong>.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">02 Nov 2014</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="http://blog.pedrazas.me/2014/11/02/asistentes-a-mi-taller-pycones-2014/" class="post-title">Asistentes a mi taller – PyCoNes 2014</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">ipedrazas</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-Docker" href="http://blog.pedrazas.me/categories/docker">Docker</a><a class="post-category post-category-Spanish" href="http://blog.pedrazas.me/categories/spanish">Spanish</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Si aún no tienes claro si vas a venir a mi taller o no, <a href="http://ivan.pedrazas.me/?p=364">lee esto</a>, y luego sigue <img src="http://ivan.pedrazas.me/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley" /></p>

<p>Parece que la conexión de internet no va a ser para tirar cohetes&#8230; nada que no hayamos sufrido todos alguna vez. Así que, para minimizar el impacto de una mala conexión hay dos opciones:</p>

<p>Usar una conexion ssh a una máquina virtual en la nube (AWS, <a href="https://www.digitalocean.com/?refcode=56ae0600c4bc">Digital Ocean</a>, Linode&#8230; o vuestro proveedor de máquinas virtuales favorito). Con ésto conseguimos que el tráfico ocurra entre esa máquina y docker, limitando el tráfico desde la sala a un puñado de conexiones ssh.</p>

<p>Otra opción es usar vuestro ordenador y descargar antes las imágenes que se van a usar. Ésta opción es más agresiva con la red por que cuando hagamos un build habrá imágenes que no se cachearán y habrá que descargarlas&#8230; y petaremos la red.</p>

<p>Si váis a usar vuestro ordenador, es recomendable que os instaléis la versión 1.3 de docker y hagáis pull de las siguientes imágenes. En negrita están las 5 imágenes base para desarrollo python:</p>

<p><strong>docker pull ubuntu</strong></p>

<p>docker pull tpires/neo4j</p>

<p><strong>docker pull dockerfile/redis</strong></p>

<p>docker pull dockerfile/mongodb</p>

<p>docker pull ipedrazas/elasticsearch</p>

<p>docker pull poklet/cassandra</p>

<p><strong>docker pull python:2</strong></p>

<p><strong>docker pull python:3</strong></p>

<p>docker pull nornagon/postgres</p>

<p>docker pull clue/ttrss</p>

<p><strong>docker pull postgres</strong></p>

<p>docker pull ipedrazas/taiga-front</p>

<p>docker pull ipedrazas/taiga-back</p>

<p>docker pull php:5.6-apache</p>

<p>docker pull node:0.10-onbuild</p>

<p>La lista no es definitiva, pero cubre mucho camino. A los que no uséis Linux, tenéis que instalar Boot2Docker y si no recuerdo mal, la versión 1.3 ya permite montar volúmenes entre host y contenedor, así que no tendréis problemas para seguir el taller.</p>

<p>Si tenéis preguntas o queréis que hable de algún tema en concreto, mandadme un email, o dadme un toque por <a href="https://twitter.com/ipedrazas">twitter</a>.</p>

<p>El taller está pensado para que la gente salga con una idea clara de lo que se puede hacer con Docker y por donde se puede empezar. Todo el material estará colgado en github.</p>

<p>Nos vemos el Sábado!</p>

<p><strong>Nota</strong>: ya empezamos otra vez con las notitas?</p>

<p><strong>Nota 2</strong>: No, el código de DO no es por que &#8220;espere forrarme&#8221;, ni mucho menos.  O sea, en serio??</p>

<p><strong>Nota 3</strong>: a ver cuántos errores y tildes encuentra <a href="https://twitter.com/yamila_moreno">Yamila</a>&#8230;</p>

<p>Nota 4: Gracias a <a href="https://twitter.com/agonzalezro">Álex</a> por corregirme 723 errores, lo menos <img src="http://ivan.pedrazas.me/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley" /></p>

                    </div>
                </section>
                
                <h1 class="content-subhead">30 Oct 2014</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="http://blog.pedrazas.me/2014/10/30/pycones-2014/" class="post-title">PyConEs 2014</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">ipedrazas</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-Docker" href="http://blog.pedrazas.me/categories/docker">Docker</a><a class="post-category post-category-Spanish" href="http://blog.pedrazas.me/categories/spanish">Spanish</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Estoy muy orgulloso de poder participar en la PyCon Española con un taller que para seguir la tradición he titulado  &#8220;<strong>50 Shades of Docker</strong>&#8220;.</p>

<p>El taller es una breve introducción a los contenedores de Linux y por qué es importante saber sobre ellos. Si eres CIO, CEO o Director de Informática de una empresa donde se usa la virtualización, éste es un taller que no te puedes perder!!!</p>

<p>De hecho, si eres programador, sysadmin o diseñador&#8230; tampoco te puedes perder!</p>

<p>Si te preguntás por qué deberías pagar <del><a href="https://www.ticketea.com/pycones14/">los 30€ de la entrada</a></del> (<a href="https://www.ticketea.com/pycones14/">20€ usando el codigo <strong>DescuentoPonentes</strong>)</a> de la PyConEs, la respuesta es muy sencilla: lo que te vas a ahorrar una vez entiendas lo que Docker puede hacer para ti o tu negocio va a compensar muy mucho el precio de la entrada.</p>

<p>El taller esta orientado de forma genérica. Los conceptos, si bien son un poco abstractos y con poca aplicación práctica, dan paso a multitud de soluciones y prácticas que se resumen en una frase muy corta:</p>

<p>&#8220;trabajar mejor&#8221;</p>

<p>Así que si estás interesado en saber o aprender cómo puedes trabajar mejor.. ya sabes, VEN!</p>

<p>Durante el taller se mostrarán ejemplos prácticos. Como todo el mundo ha padecido alguna vez, durante las conferencias la conexión a Internet sufre bastante, es por eso que se recomienda a los asistentes que usen una conexión remota (con <a href="https://www.digitalocean.com/?refcode=56ae0600c4bc">éste código</a> puedes obtener <a href="https://www.digitalocean.com/?refcode=56ae0600c4bc">$10 gratis</a> en Digital Ocean, más que suficiente para que cada asistente pueda realizar el taller durante un par de meses).</p>

<p>Si prefieres usar tu ordenador, deberás asegurarte que tienes la última versión de <a href="https://docs.docker.com/installation/#installation">Docker instalada</a>, y una vez la tengas instalada, ejecuta el setup.sh que hay en el repositorio de mi github.</p>

<p>&nbsp;</p>

<p><strong>Nota</strong>: estoy montando el repo durante esta semana, así que no te sorprendas que el setup cambie un poquillo</p>

<p><strong>Nota 2</strong>: El setup lo único que hace es bajarse las imágenes que usaremos durante el taller.</p>

<p><strong>Nota 3</strong>: Sí, voy a traer mis Google Glass, pero si vienes a mi taller por unas gafas sin cristales tú y yo tenemos que hablar!</p>

<p><strong>Nota 4</strong>: cualquier duda, <a href="https://twitter.com/ipedrazas">pregunta</a>!</p>

<p><strong>Nota 5</strong>: si la duda es de <a href="https://golang.org/">Golang</a>, preguntadle a <a href="https://twitter.com/agonzalezro">Alex</a>!</p>

<p><strong>Última Nota</strong>: El <a href="https://twitter.com/juanriaza">maestro Riaza</a> se ha comprometido a llevarme a comer a un lugar &#8220;secreto&#8230; dice&#8221; que va a superar con creces la comida de la pasada PyCon. Como dicen por aqui: really looking forward to eating there <img src="http://ivan.pedrazas.me/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley" /></p>

                    </div>
                </section>
                
                <h1 class="content-subhead">08 Oct 2014</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="http://blog.pedrazas.me/2014/10/08/local-taiga-with-docker/" class="post-title">Local Taiga with Docker</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">ipedrazas</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-Docker" href="http://blog.pedrazas.me/categories/docker">Docker</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Recently <a href="https://taiga.io/">Taiga.io</a> was announced. As they describe themselves:</p>

<blockquote>
<p>Free. Open Source. Powerful. <strong>Taiga</strong> is a project management platform for startups and agile developers &amp; designers who want a simple, <strong>beautiful</strong> tool that makes work truly enjoyable.</p>
</blockquote>

<p>It didn&#8217;t take me too long to realise that it would be a nice preparation to dockerize taiga for my next &#8220;50 Shades of Docker&#8221; workshop at the Spanish PyCon.</p>

<p>I have to reckon that it&#8217;s been more challenging than expected. I would blame the developers, of course  <img src="http://ivan.pedrazas.me/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley" />but truth is that turning taiga into a docker container is quiet simple (specially since they provide all the scripts to build a taiga platform in one single host).</p>

<p>Unfortunately for me, I like distributing things&#8230; so I decided to run one single process per container, so I would have several containers.</p>

<p>The scripts installed Redis and RabbitMQ which are not in use (just yet), so teh final version has 3 containers:</p>

<ul>
<li>Postgres</li>
<li><del>RabbitMQ</del></li>
<li><del>Redis</del></li>
<li>Taiga-back</li>
<li>Taiga-front</li>
</ul>

<p>Another problem I found is that the front-end is not distributable. It means, you have to build it&#8230; so, I created another container that does the build.</p>

<p>If you want to run taiga in your local machine, you can do so by using this script:</p>

<pre>sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 36A1D7869245C8950F966E92D8576A8BA88D21E9
sudo sh -c "echo deb https://get.docker.io/ubuntu docker main &gt; /etc/apt/sources.list.d/docker.list"
sudo apt-get update -y
sudo apt-get install -y lxc-docker

sudo mkdir -p /data/postgresql

sudo docker run -d --name postgres    -p 5432:5432  -v /data/postgresql:/var/lib/postgresql/data postgres
sudo docker run -d --name taiga-back  -p 8001:8001  --link postgres:postgres ipedrazas/taiga-back
sudo docker run -d --name taiga-front -p 80:80 -p 8000:8000 --link taiga-back:taiga-back ipedrazas/taiga-front


sudo docker run -it --link postgres:postgres --rm postgres sh -c "su postgres --command 'createuser -h "'$POSTGRES_PORT_5432_TCP_ADDR'" -p "'$POSTGRES_PORT_5432_TCP_PORT'" -d -r -s taiga'"
sudo docker run -it --link postgres:postgres --rm postgres sh -c "su postgres --command 'createdb -h "'$POSTGRES_PORT_5432_TCP_ADDR'" -p "'$POSTGRES_PORT_5432_TCP_PORT'" -O taiga taiga'";
sudo docker run -it --rm --link postgres:postgres ipedrazas/taiga-back bash regenerate.sh
</pre>

<p>If, like me, you want to run it in AWS or Digital Ocean, you will need first to create a DNS and build Taiga using that host (yes, the api url is hardcoded&#8230; so, you have to build it using your hostname).</p>

<p>Having said that, I want to congratulate the whole Taiag team for the product and the support they have been giving (not only to me, but to many others). <strong>Well done, guys!</strong></p>

<p>All the code is in my <a href="https://github.com/ipedrazas/taiga-docker">Github Repo</a>, in case that anyone wants to play with it. If you have any doubts, <a href="https://twitter.com/ipedrazas">just ask</a> <img src="http://ivan.pedrazas.me/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley" /></p>

                    </div>
                </section>
                
                <h1 class="content-subhead">22 Sep 2014</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="http://blog.pedrazas.me/2014/09/22/the-art-of-testing-in-the-rain/" class="post-title">The Art of Testing in the rain</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">ipedrazas</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-Development" href="http://blog.pedrazas.me/categories/development">Development</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p><span style="color: #333333;"><span style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;">Testing is hard. We all know that. Testing distributed applications is just a nightmare. Like having Jason, Freddy Krugger and legions of zombies chasing you while you run barefoot, naked and of course, in the rain.</span></span></p>

<p><span style="color: #333333;">Why it&#8217;s so hard? Well, let&#8217;s look at it. We have </span><strong><span style="color: #333333;">Unit Testing</span></strong><span style="color: #333333;">, where we test that our code does what it has to do. Then, we have </span><strong><span style="color: #333333;">Integration Test</span></strong><span style="color: #333333;">, where we test that our code can connect and query other systems. Finally, we have </span><strong><span style="color: #333333;">System Test</span></strong><span style="color: #333333;">, where we want to test if our application works.</span></p>

<p><span style="color: #333333;"><span style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;">Questions you ask during <strong>Unit Testing</strong>:</span></span></p>

<ul>
<li><span style="color: #333333;"><span style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;">Does this method return this expected value?</span></span></li>
<li><span style="color: #333333;"><span style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;">Does this method parse this XML properly?</span></span></li>
<li><span style="color: #333333;"><span style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;">Does this method transform this object into this other one?</span></span></li>
</ul>

<p><span style="color: #333333;"><span style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;">Questions you ask during <strong>Integration Test</strong>:</span></span></p>

<ul>
<li><span style="color: #333333;"><span style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;">Can my application connect to the database?</span></span></li>
<li><span style="color: #333333;"><span style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;">Does this method return any data?</span></span></li>
<li><span style="color: #333333;"><span style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;">Does this API call return the Json objects as I expect?</span></span></li>
</ul>

<p><span style="color: #333333;"><span style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;">Finally, <strong>System Test</strong>:</span></span></p>

<ul>
<li><span style="color: #333333;"><span style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;">Can I log in?</span></span></li>
<li><span style="color: #333333;"><span style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;">Can I sign up as a new user?</span></span></li>
<li><span style="color: #333333;"><span style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;">When I delete this message, does it goes away?</span></span></li>
</ul>

<p><span style="color: #333333;"><span style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;">And this last bit, this last bit it&#8217;s terribly hard because you have different systems and a frontend to deal with and not only that, you have to have a system that replicates production (and this is expensive and time consuming).</span></span></p>

<p><span style="color: #333333;"><span style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;">So, why testing is so hard? because there are many dependencies at many different layers that are very difficult to replicate (have I talked about firewalls? well, maybe I should)</span></span></p>

<p><span style="color: #333333;"><span style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;">Unit Testing can be done as a pre-building task. Cheap, easy.</span></span></p>

<p><span style="color: #333333;"><span style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;">Integration Test needs two system talking to each other: our code, and the system my code is connecting to. Not as cheap as it seems. Mocking up is a way of reducing the cost of running two (or more) systems. But don&#8217;t deceive yourself, when mocking you are unit testing.</span></span></p>

<p><span style="color: #333333;"><span style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;">System Test needs all the systems in place properly configured. Expensive.</span></span></p>

<p><span style="color: #333333;"><span style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;">Take this, testing your application is not an extra life, it&#8217;s a sneak peak to the dangers that stalk ahead.</span></span></p>

<p><span style="color: #333333;"><span style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;">So, how much effort I should put on testing? as much as you can. Read it again: as much as you can. It depends. Let&#8217;s put it like this, the more effort you put in proper testing, the less effort you will have to put when deploying to production.</span></span></p>

<p><span style="color: #333333;"><span style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;">Testing is hard, and with every release, with every problem we find in production we learn (like simulating dodgy firewalls), but you should take Testing like that: a learning exercise.</span></span></p>

<p><span style="color: #333333;"><span style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;">I&#8217;m planning to write a series of posts about Integration and System Testing. So, if you&#8217;re interested, bear with me! </span></span></p>

                    </div>
                </section>
                
                <h1 class="content-subhead">18 Sep 2014</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="http://blog.pedrazas.me/2014/09/18/cassandra-and-docker-round-1/" class="post-title">Cassandra and Docker – round 1</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">ipedrazas</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-Cassandra" href="http://blog.pedrazas.me/categories/cassandra">Cassandra</a><a class="post-category post-category-Docker" href="http://blog.pedrazas.me/categories/docker">Docker</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p><a href="http://ivan.pedrazas.me/wp-content/uploads/2014/09/Cassandra_logo.svg_.png"><img class="aligncenter size-medium wp-image-340" src="http://ivan.pedrazas.me/wp-content/uploads/2014/09/Cassandra_logo.svg_-300x201.png" alt="Cassandra_logo.svg" width="300" height="201" /></a></p>

<p>&nbsp;</p>

<p>This last week I&#8217;ve spent some time trying to set up Cassandra in Docker. My starting point was this Docker Image called <a href="https://registry.hub.docker.com/u/poklet/cassandra/">pokle/cassandra</a>.</p>

<p>There are things from that image that I don&#8217;t like and I&#8217;ve been very tempeted to fork it, but as I said, it was a starting point, and for what we need now, it&#8217;s good enough.</p>

<p>Basically what I wanted was to have a cluster of 3 machines running in Docker, talking to each other and letting me &#8220;play away&#8221;.</p>

<p>I&#8217;m re-writing dotMarks in java using Dropwizard and, of course, Cassandra. Anyway, this post is about how to set up that cluster.</p>

<p>Open your terminal and paste this:</p>

<pre># Make dirs to store your data
sudo mkdir -p /data/cassandra/{c1,c2,c3}/data
sudo mkdir -p /data/cassandra/{c1,c2,c3}/commitlog

# Change permissions so the Cassandra user can write on them
sudo chmod 777 /data/cassandra/{c1,c2,c3}/data
sudo chmod 777 /data/cassandra/{c1,c2,c3}/commitlog

# Run the Docker containers with Cassandra
docker run -d --name c1 -v /data/cassandra/c1/data:/var/lib/cassandra/data -v /data/cassandra/c1/commitlog:/var/lib/cassandra/commitlog poklet/cassandra
docker run -d --name c2 -v /data/cassandra/c2/data:/var/lib/cassandra/data -v /data/cassandra/c2/commitlog:/var/lib/cassandra/commitlog poklet/cassandra start $(./scripts/ipof.sh c1)
docker run -d --name c3 -v /data/cassandra/c3/data:/var/lib/cassandra/data -v /data/cassandra/c3/commitlog:/var/lib/cassandra/commitlog poklet/cassandra start $(./scripts/ipof.sh c1)

# Open a CQLSH console
docker run -it --rm --link c1:c1 -v /data/cassandra/scripts:/data poklet/cassandra bash -c 'cqlsh $C1_PORT_9160_TCP_ADDR'

</pre>

<p>Now you should have a C* cluster of 3 containers. Run docker ps and you should see something like this:</p>

<p>&nbsp;</p>

<pre>-&gt; % docker ps
CONTAINER ID        IMAGE                     COMMAND               CREATED              STATUS              PORTS                                                                           NAMES
f85542cb46e3        poklet/cassandra:latest   "start 172.17.0.14"   About a minute ago   Up About a minute   8012/tcp, 9042/tcp, 9160/tcp, 22/tcp, 61621/tcp, 7000/tcp, 7001/tcp, 7199/tcp   c3                  
9cfdccaf1213        poklet/cassandra:latest   "start 172.17.0.14"   About a minute ago   Up About a minute   9160/tcp, 22/tcp, 61621/tcp, 7000/tcp, 7001/tcp, 7199/tcp, 8012/tcp, 9042/tcp   c2                  
162c36a8b876        poklet/cassandra:latest   "/bin/sh -c start"    2 minutes ago        Up 2 minutes        9042/tcp, 9160/tcp, 22/tcp, 61621/tcp, 7000/tcp, 7001/tcp, 7199/tcp, 8012/tcp   c1    
</pre>

<p>Now, you might want to add some data. We do that using another container that will execute <em><strong>CQLSH</strong></em>.</p>

<pre>docker run -it --rm --link c1:c1 -v /data/cassandra/scripts:/data poklet/cassandra bash -c 'cqlsh $C1_PORT_9160_TCP_ADDR'
</pre>

<p>Note that by using Links you don&#8217;t need to know the IPs of the nodes. We will need them to connect if we don&#8217;t use a container with links, but let&#8217;s see that problem later.</p>

<p>Once you are in the CQLSH, add some data:</p>

<pre>CREATE KEYSPACE dotmarks WITH REPLICATION =
 {'class': 'SimpleStrategy', 'replication_factor': 1};

 USE dotmarks;

 CREATE TABLE test_table (
  id text,
  test_value text,
  PRIMARY KEY (id)
 );


INSERT INTO test_table (id, test_value) VALUES ('1', 'one');
INSERT INTO test_table (id, test_value) VALUES ('2', 'two');
INSERT INTO test_table (id, test_value) VALUES ('3', 'three');

SELECT * FROM test_table;
</pre>

<p>If you want to check the data from a different node, do this:</p>

<pre>docker run -it --rm --link c2:c2 -v /data/cassandra/scripts:/data poklet/cassandra bash -c 'cqlsh $C2_PORT_9160_TCP_ADDR'


Connected to Test Cluster at 172.17.0.15:9160.
[cqlsh 4.1.1 | Cassandra 2.0.9 | CQL spec 3.1.1 | Thrift protocol 19.39.0]
Use HELP for help.
cqlsh&gt; use dotmarks;
cqlsh:dotmarks&gt; select * from test_table;

 id | test_value
----+------------
  3 |      three
  2 |        two
  1 |        one

(3 rows)

cqlsh:dotmarks&gt; 
</pre>

<p>With this, we have our cluster ready to rock and roll! In the next post, we will see how to confdigure and connect our Dropwizard App to our Cassandra cluster.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">07 Sep 2014</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="http://blog.pedrazas.me/2014/09/07/from-my-browsing-history/" class="post-title">Analytics From my Browsing History</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">ipedrazas</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-analytics" href="http://blog.pedrazas.me/categories/analytics">analytics</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>One of the problems I had while writing dotMarks was the fact that I could not get enough URLs for my testing. I did ask friends and family to send me over their exported list of bookmarks or the bookmarks from pocket&#8230; but <a href="https://www.youtube.com/watch?v=Pj-qBUWOYfE">I needed more data</a>, so, I look somewhere else: My browsing history.</p>

<p>Of course I couldn&#8217;t just get those links &#8220;<strong><em>and carry on</em></strong>&#8220;. I had to look at them, poke them and write an extension that allows me to analyse them.</p>

<p>Because, the idea was&#8230; what kind of high level information can Google (or anyone else) know from just looking at my browing history? and the result was as scary as you might imagine.</p>

<p>Bear in mind that Google knows much more than just my history&#8230; but that&#8217;s for another post. Let&#8217;s focus!</p>

<p>This extension basically gathers all your browing history (100 days max), sends it to dotmarks where some data-crunching happens and&#8230; then you see the results.</p>

<p>For example, it checks at what time you visit a link and creates this pretty graph:</p>

<p><a href="http://ivan.pedrazas.me/wp-content/uploads/2014/09/Screenshot-from-2014-09-07-111057.png"><img class="aligncenter size-medium wp-image-330" src="http://ivan.pedrazas.me/wp-content/uploads/2014/09/Screenshot-from-2014-09-07-111057-300x167.png" alt="Screenshot from 2014-09-07 11:10:57" width="300" height="167" /></a></p>

<p>Which highlights something that everybody who knows me is aware of: I do not sleep much and&#8230; that I work very early in the morning, or very late at night.</p>

<p>I was very curious about finding out my most visited websites&#8230; nothing surprising here:</p>

<p><a href="http://ivan.pedrazas.me/wp-content/uploads/2014/09/Screenshot-from-2014-09-07-111147.png"><img class="aligncenter size-medium wp-image-328" src="http://ivan.pedrazas.me/wp-content/uploads/2014/09/Screenshot-from-2014-09-07-111147-300x207.png" alt="Screenshot from 2014-09-07 11:11:47" width="300" height="207" /></a></p>

<p>That I do not procastinate as much as I thought is quiet clear (twitter reloads itself a lot, that&#8217;s why it ranks so high), but mostly I work on my localhost&#8230; and check how my Bitcoins are doing at <a href="http://megamine.com/">Megamine</a>.</p>

<p><a href="http://ivan.pedrazas.me/wp-content/uploads/2014/09/theres-no-place-like-127-0-0-1-localhost-computer-print-poster.jpg"><img class="aligncenter size-medium wp-image-333" src="http://ivan.pedrazas.me/wp-content/uploads/2014/09/theres-no-place-like-127-0-0-1-localhost-computer-print-poster-300x200.jpg" alt="theres-no-place-like-127-0-0-1-localhost-computer-print-poster" width="300" height="200" /></a></p>

<p>Then, I started extracting keywords from my searches&#8230; and things got more interesting:</p>

<p><a href="http://ivan.pedrazas.me/wp-content/uploads/2014/09/Screenshot-from-2014-09-07-111126.png"><img class="aligncenter size-medium wp-image-329" src="http://ivan.pedrazas.me/wp-content/uploads/2014/09/Screenshot-from-2014-09-07-111126-300x209.png" alt="Screenshot from 2014-09-07 11:11:26" width="300" height="209" /></a></p>

<p>Yes, I do search about superheroes a lot&#8230; things of having children addicted to Thor, Spiderman and such troop.</p>

<p>What is really interesting is how high rank generics like java, python or ubuntu. I was a bit puzzled at first, then I realised that those keywords are ways of filtering out unwanted results. No surprise then, I do work with ubuntu, java and python.</p>

<p>Still, top marks for the two technologies I&#8217;ve been working more with: ElasticSearch and Docker. ElasticSearch documentation is quite dry&#8230; Docker, because I&#8217;m trying to do a bit too much I guess.</p>

<p><a href="https://dotmarks.net">dotMarks</a> is a self hosted bookmarks service. The idea is that you will run your own dotMarks server. I&#8217;m working hard to make it as easy as possible to run it (thanks to Docker) but if you&#8217;re curious and want to see what your browsing history says about you, <a href="https://github.com/ipedrazas/dotmarks-history">download the extension</a> and give it a go.</p>

<p>What I need is advice  <img src="http://ivan.pedrazas.me/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley" />If you run the extension and think of something else I can extract I&#8217;m all ears.</p>

<p>Currently I&#8217;m working on a simple amazon parser, but it&#8217;s still very early&#8230; anyway, if you want to give it a go, by all means try it out and if you can share your feedback <a href="https://twitter.com/ipedrazas">with me</a>, I would really appreciate it.</p>

<p>&nbsp;</p>

<p><strong>Disclaimer</strong>: <a href="https://dotmarks.net">dotMarks</a> and all related to this project is OpenSource. I do have a working version <a href="https://dotmarks.net/app/#/dotmarks">here</a>, but as I said, the idea is that you will run your own service. Still, if you want to add your bookmarks, go ahead, and if you want to be able to find them later, use a tag that you can recognise later.</p>

<p>&nbsp;</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">22 Aug 2014</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="http://blog.pedrazas.me/2014/08/22/how-to-build-microservices-in-java-without-losing-your-sanity/" class="post-title">How to build (and run) Microservices in Java without losing your Sanity</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">ipedrazas</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-Development" href="http://blog.pedrazas.me/categories/development">Development</a><a class="post-category post-category-Docker" href="http://blog.pedrazas.me/categories/docker">Docker</a><a class="post-category post-category-Java" href="http://blog.pedrazas.me/categories/java">Java</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>If you haven&#8217;t heard about Microservices, <a href="http://martinfowler.com/articles/microservices.html">go here</a> and read about them!</p>

<p>For a long time I&#8217;ve writen all my microservices using Python because Java had a massive overhead (called a Servlet Container).</p>

<p>I&#8217;m not sure how I stumbled upon DropWizard, but it has done something that I thought impossible: My Ops side has loved Java back.</p>

<p>What do I want?</p>

<p>I want to be able to define a simple REST service and publish it with as little dependencies as possible.</p>

<p>Yes, I can write a JAX-RS class and run:</p>

<pre>-&gt;%mvn jetty:run
</pre>

<p>And my servlet container will expose my REST service&#8230; but let&#8217;s face it, deploying services like this will not take us too far. Like, are you planning to run a Jetty/Tomcat service per MicroService you want to expose??? Yes, this is where my Ops side of me was cringing big time.</p>

<p>True, I could bundle services and&#8230; and little by little we will find ourselves walking away from our beloved Microservices because of &#8220;Operations is complicated&#8221;. Operations is hard, we all know that, but a good architecture has to provide enough tools to satisfy our design goals without compromise our operations.</p>

<p>Solution? I&#8217;m sure It won&#8217;t surprise any of my followers: it&#8217;s to use <strong>Docker and&#8230; DropWizard</strong>!!!</p>

<p>How, you don&#8217;t know <a href="https://dropwizard.github.io">DropWizard</a>? run to their website and sort that out: NOW! DropWizard does a lot of things, one of them is awesome: It allows you to write a JAX-RS class and run it from your command line. I mean, it creates a fat jar file that you can then run:</p>

<pre>java -jar my_microservice-0.0.1-SNAPSHOT.jar server my_microservice_conf.yml
</pre>

<p>And&#8230; it will expose your rest service in the port 8080 (and it comes with an admin freebie in port 8081 &lt;&#8211; my ops side of me is very happy about this).</p>

<p>Now&#8230; what happens if you build a Docker image that runs that instruction? That you have an easy way to run/test/distribute your microservice.</p>

<pre>sudo docker run -d -p 9094:8080 7887:8081 ipedrazas/m_dotmarks:latest
</pre>

<p>Note that all my microservices are exposed using the default ports: 8080 and 8081 and then I re-map them when running them in Docker. Why? because it gives me more flexibility and I don&#8217;t have to worry about Ops while doing Dev (yes, developers do not decide how to run the service).</p>

<p>As always, I strongly recommend to run nginx as a gateway to your dockerized services. In this case our two ports 8080 and 8081 will be remmaped to 9094 (that nginx will expose using a url like api.dotmarks.net/dotmarks) and 7887 that will be used internally only.</p>

<p>These holidays I&#8217;ve been rewriting my <a href="https://dotmarks.net/">dotMarks</a> app originally in python in Java using DropWizard and I will be releasing the code once it works.</p>

<p>Stay tunned!</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">05 Aug 2014</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="http://blog.pedrazas.me/2014/08/05/fhr-elasticsearch-aggregations/" class="post-title">What’s the Filthiest PostCode in UK? and the Cleanest too!</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">ipedrazas</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-Development" href="http://blog.pedrazas.me/categories/development">Development</a><a class="post-category post-category-Java" href="http://blog.pedrazas.me/categories/java">Java</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>There&#8217;s a <a href="https://github.com/ipedrazas/crawlers/tree/master/FHR">GitHub repo</a> associated to this post that <a href="https://github.com/ipedrazas/crawlers/tree/master/FHR">it can be found here</a></p>

<p>Do you know that sticker on the window of most takeaway shops? that sticker displays the Hygiene rating. This post is not about those stickers.</p>

<p><img class="aligncenter size-full wp-image-303" src="http://ivan.pedrazas.me/wp-content/uploads/2014/08/fhrs_5_en-gb.jpg" alt="Hygiene Rating Sticker" width="290" height="148" /></p>

<p>Now, as it happens, restaurants, deli bars and of course, take away shops are checked up regularly to see how clean are they and the collected information ends up in a report, a sticker and&#8230; some dark and remote database.</p>

<p>After doing the ElastiSearch training three weeks ago I was itching to do some aggregations with it. I have done aggregations before using &#8220;<em>Ye Olde</em>&#8221; Map/Reduce approach and I was interested on seeing how it would compare to do agregations with MongoDB.</p>

<p>I found the Food and Higiene dataset and a python script later I had all their data in my hard drive (just under 500MB of XMLs). Since I like diversity, I wrote a Java program to parse those XMLs and add them into my ElasticSearch instance. It really surprised me the amount of time spent on preparing the data before being able to execute the analysis. I know, it shouldn&#8217;t but it does&#8230; every single time it does.</p>

<p>Anyway, I run ElasticSearch in a docker instance that has the Marvel plugin in it. This plugin is perfect for throwing a few quick queries and getting some json back. Of course, me being me, I could not just do some tests and write a blog post&#8230; I had to create <a href="https://github.com/ipedrazas/crawlers/tree/master/FHR">a Github Repo</a> where you can find the source code (just in case you do want to try it by yourself), results (in json files) and some more detailed explanation about how to fetch the data, run the docker container and the different queries I issued.</p>

<p>After indexing almost half a Gigabyte I discovered that the average rating In UK for Food Hygiene is <strong>3.5849</strong> which is not that great, is it? I mean, we are talking about how clean is the place where we eat: &#8220;kind of not clean but not dirty neither&#8221;.</p>

<p>What else did I find? Well, I was interested on my area (NW10) average: <strong>3.23910171730515  </strong>Depressing, I guess it&#8217;s time to move to&#8230; where?</p>

<p>Well, let&#8217;s find out, what&#8217;s the cleanest Post Code? I didn&#8217;t know much about UK PostCodes. Post Code indicates the area (outward) and the building/house (inward). The dataset provides longitude and latitude for every single establishment so you don&#8217;t really need the PostCode to put the stablishment in a map. Anyway, that was not my intention.</p>

<p>So, as it turns, the cleanest Post Code is <a href="https://www.google.co.uk/maps/place/South+Petherton,+Somerset+TA13/@50.8277828,-2.2505537,9z/data=!4m2!3m1!1s0x48726c54bfd88a65:0xc91f5b601623f2d1">SOUTH PETHERTON (TA13)</a>, or if you think that 42 establishments and an average of <strong>4.761904761904762</strong> is not significant enough I can move to <a href="https://www.google.co.uk/maps/place/Taunton,+Somerset/@52.1627957,-1.8741876,7z/data=!4m2!3m1!1s0x486d8a921fb7907f:0x75eb0e344edee9fb">TAUNTON (TA3)</a> with a wooping average of <strong>4.642857142857143</strong></p>

<p>And now that we know where to go, which place we should all avoid? Ladies and Gentlemen, the filthiest area in UK is (shame on you)&#8230;</p>

<p><a href="https://www.google.co.uk/maps/place/Hawick,+Scottish+Borders+TD9/@53.3002712,-2.738034,7z/data=!4m6!1m3!3m2!1s0x487d796662ced111:0x2cc564208e63c086!2sShankend+Holiday+Cottage+Hawick!3m1!1s0x487d605a6cc3a265:0x188c40d9107d6db6">HAWICK, NEWCASTLETON (TD9)</a> with a terrible average of <strong>0.013761467889908258</strong> (yes, that&#8217;s Zero point Zero One).</p>

<pre>{
   "key": "td9",
   "doc_count": 218,
   "avg_height": {
      "value": 0.013761467889908258
   }
},

 {
   "key": "ta13",
   "doc_count": 42,
   "avg_height": {
      "value": 4.761904761904762
   }
},
{
   "key": "ta3",
   "doc_count": 112,
   "avg_height": {
      "value": 4.642857142857143
   }
},
</pre>

<p>But let&#8217;s not stop there&#8230; What is the most common rating? XX</p>

<p>The Food Standars Agency has a web form that let&#8217;s you check the rating of your favourite place.</p>

<p>Let me show you one of the queries I used, just in case you&#8217;re looking at how to do aggregations with ElasticSearch and are struggling with the lack of documentation:</p>

<pre>GET _search
{

   "query" : {
      "match" : { "PostCode" : "PO18*"}
       },
   "aggs" : {
        "Food_hygiene_ratings" : {
           "terms" : {
             "field" : "RatingValue"
           }
        },

        "avg_height" : {
          "avg" : {
            "field" : "RatingValue" }

        }
      }
}
</pre>

<p>This query matches a PostCode (PO18 ) and then it aggregates twice the result using the field RatingValue. The first one will give you the count of the different ratings and the second one will give you the average of the rating.</p>

<p>Conclusion? prepating the data was quiet of a pain, but it always is. Loading the data was blazing fast and the results were pretty quick too. The aggregation of all the PostCodes took a few seconds and the huge amount of data that it returned was impressive.</p>

<p>All in all, a very quick way of getting some json data to feed into the D3 visualisations.</p>

<p><a href="http://en.wikipedia.org/wiki/List_of_postcode_areas_in_the_United_Kingdom">http://en.wikipedia.org/wiki/List_of_postcode_areas_in_the_United_Kingdom</a></p>

<pre>GET _search
{

   "aggs" : {
        "Food_hygiene_ratings" : {
           "terms" : {
             "field" : "areacode",
             "size": 0,
             "order": {
                    "avg_height": "desc"
                }

           },

           "aggs":{
             "postcodes":{
             "terms" : {
               "field" : "RatingValue"
              }
             }
             ,

        "avg_height" : {
          "avg" : {
            "field" : "RatingValue"

          }

        }
           }
        }
      }
}
</pre>

<p>Once we know the area, we want to filter by outward</p>

<p><strong>Worst case TD</strong></p>

<pre>GET _search
{

    "query" : {
      "match" : { "areacode" : "td"}
       },
   "aggs" : {
        "Food_hygiene_ratings" : {
           "terms" : {
             "field" : "outward",
             "size": 0,
             "order": {
                    "avg_height": "desc"
                }

           },

           "aggs":{

              "avg_height" : {
                "avg" : {
                  "field" : "RatingValue"
                }

              }
           }
      }
    }
}

</pre>

<p><strong>Worst case</strong></p>

<pre>"key": "td",
   "doc_count": 1492,
   "postcodes": {
      "buckets": [
         {
            "key": 0,
            "key_as_string": "0",
            "doc_count": 1244
         },
         {
            "key": 5,
            "key_as_string": "5",
            "doc_count": 152
         },
         {
            "key": 4,
            "key_as_string": "4",
            "doc_count": 53
         },
         {
            "key": 3,
            "key_as_string": "3",
            "doc_count": 37
         },
         {
            "key": 1,
            "key_as_string": "1",
            "doc_count": 4
         },
         {
            "key": 2,
            "key_as_string": "2",
            "doc_count": 2
         }
      ]
   },
   "avg_height": {
      "value": 0.7312332439678284
   }
},

</pre>

<p><strong>Best case</strong></p>

<pre>{
   "key": "ta",
   "doc_count": 2823,
   "postcodes": {
      "buckets": [
         {
            "key": 5,
            "key_as_string": "5",
            "doc_count": 1955
         },
         {
            "key": 4,
            "key_as_string": "4",
            "doc_count": 521
         },
         {
            "key": 3,
            "key_as_string": "3",
            "doc_count": 152
         },
         {
            "key": 0,
            "key_as_string": "0",
            "doc_count": 107
         },
         {
            "key": 1,
            "key_as_string": "1",
            "doc_count": 52
         },
         {
            "key": 2,
            "key_as_string": "2",
            "doc_count": 36
         }
      ]
   },
   "avg_height": {
      "value": 4.406305348919589
   }
},
</pre>

                    </div>
                </section>
                
                <h1 class="content-subhead">27 Jul 2014</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="http://blog.pedrazas.me/2014/07/27/gmit/" class="post-title">GmIT</a>

                        <p class="post-meta">
                            
                                By <strong class="post-author">ipedrazas</strong>
                            
                            
                                under 
                                
                                <a class="post-category post-category-DevOps" href="http://blog.pedrazas.me/categories/devops">DevOps</a>
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>(Graph my IT)</p>

<p><strong>The problem:</strong> We&#8217;re in the process of upgrading our Documentum platform. As part of this upgrade I had to get in contact with all the owners of the different applications that use, connects or access Documentum. They all had to test, and if possible, upgrade their internal Documentum libraries.</p>

<p>The main issue was that it was not clear which applications were connecting to our different services or who was the right person to get in touch with.</p>

<p>My Solution? spending a few days going around the building talking to different teams and people to make sure the message was received.</p>

<p>I know what you are thinking: proper documentation and email could have well solved my problem but if you work in a fairly large organisation like I do, it will not surprise you that the documentation was not complete and it was not up to date. Half of the people the documentation mentioned was not working in those teams anymore, and some of them had move on to brightest lands.</p>

<p>As I said, I spent some quality time with different teams. Specially rewarding was my time with the networking team checking out the firewall to know which IPs were connecting to my servers. Having meetings with different group (developers, primary support, help desk, administrators&#8230;) to make sure we had everything under control.</p>

<p>All this took a fairly amount of time and yes, it can be improved a lot and this post talks about what I did to start sailing towards that remote port.</p>

<p>Once I had all the details of people, machine, roles, and infrastructure I realise that a Spreadsheet (the way this information was officially kept) was not fit for purpose. I realise pretty quickly that I was looking at a graph and that finally I had stumbled upon a nice Use Case for <a href="http://www.neo4j.org/">Neo4J</a>.</p>

<p><a href="http://ivan.pedrazas.me/wp-content/uploads/2014/07/neo4j.png"><img class="aligncenter size-medium wp-image-283" src="http://ivan.pedrazas.me/wp-content/uploads/2014/07/neo4j-300x73.png" alt="neo4j" width="300" height="73" /></a></p>

<p>The first time I had knowledge of Neo4J was in NOSQL eXchange in 2011. Since then, every time I&#8217;ve looked at their technology I&#8217;ve seen really cool things like graphs about Dr. Who or more recently The World Cup but as cool as these examples were, they were not very business focused, really. I mean, mapping daleks and doctors have a very different business value than mapping servers and applications (unless you work for BBC or you just happen to be The Doctor, of course).</p>

<p><a href="http://ivan.pedrazas.me/wp-content/uploads/2014/07/koans_drwho.png"><img class="aligncenter wp-image-282 size-medium" src="http://ivan.pedrazas.me/wp-content/uploads/2014/07/koans_drwho-300x224.png" alt="koans_drwho" width="300" height="224" /></a></p>

<p>I have to reckon that it took me a fair bit too long to get into graphs (I will blame Dr. Who and the World Cup!!)</p>

<p>Neo4j is not as different to any other database, this means: getting your data model right is fundamental&#8230; however, Neo4j has something else&#8230; it provides a bunch of relationships which will transform your data model.</p>

<p>Let me give you a visual example of what&#8217;s going to happen with you data model once you try to use Neo4J is the Pizza dough. Let&#8217;s assume your Data Architect defined the data model. That would be the dough. If Neo4J were the pizza master, this is what will happen: it will get your data model, it will stretch it, it will shrink it, it will make it spin, it will bake it and finally&#8230; it will be ready for consumption in a very different way it was at the very beginning.</p>

<div id="attachment_286" style="width: 310px" class="wp-caption aligncenter">
  <a href="http://ivan.pedrazas.me/wp-content/uploads/2014/07/2160246890_94819d31ab.jpg"><img class="size-medium wp-image-286" src="http://ivan.pedrazas.me/wp-content/uploads/2014/07/2160246890_94819d31ab-300x300.jpg" alt="Defining your Data Model like a Pro!" width="300" height="300" /></a>
  
  <p class="wp-caption-text">
    Defining your Data Model like a Pro!
  </p>
</div>

<p>Seriously. I worked with Postgres, MongoDB, ElasticSearch, Redis, Dynamo&#8230; and the datasource that has changed my data model the most is Neo4J, by far!</p>

<p>I started designing my model using the entities we had in the Spreadsheet&#8230; it didn&#8217;t work. Because flat is not good, and dealing with spreadsheets is what you get: flatland.</p>

<p>We had a list of applications and person to contact: <strong>Application Name, Owner</strong></p>

<p>Every Application had a document where it was defined the different machines they used per environment. Yes, that means one document per row in your list.</p>

<p>Then, you had another list of: <strong>Application, Administrator</strong></p>

<p>And yet another one with: <strong>Application, Support Team</strong></p>

<p>You can put any kind of crazy stuff into a spreadsheet as reality has confirmed to all of us, but the hard truth is that a flat table is just that, a flat data layout. Besides, the fact that you have all that data in a document (with an owner and a path) makes things even worse (people don&#8217;t tend to like other people&#8217;s updating their documents).  Anyway, I decided to run a docker container with Neo4j in it. Easy!</p>

<p>My first model was something like this:</p>

<p>&#8211; Application [IP, OS, Name]</p>

<p>&#8211; Person [Name, email, extension]</p>

<p>&#8211; Role [name]</p>

<p>With this first model I achieved something unseen before: I could map my application with all the dependencies and all the people involved but&#8230; It was not very clear. If a person had 2 roles (I am the admin of an application, and support another one, the graph gets confusing. You want to know what the person does, not where he belongs&#8230;)</p>

<p>Second iteration:</p>

<p>&#8211; Application [IP, OS, Name] :: r[CONNECTS]</p>

<p>&#8211; Person [Name, email, extension] :: [ADMINS | SUPPORTS ]</p>

<p>Applications run in clusters and machine information is quiet important (because we have firewall rules per machine, and IPs are per machine not application). Third iteration:</p>

<p>&#8211; Application [Name, Build Version] :: r[CONNECTS]</p>

<p>&#8211; Person [Name, email, extension] :: [ADMINS | SUPPORTS | HAS_ACCESS]</p>

<p>&#8211; Server [Name, IP, OS] :: r[RUNS]</p>

<p>Well, I&#8217;m not sure what&#8217;s the best way of describing relationships to an entity but in a nutshell, an application can connect to another application, an application runs in one or more servers, people administers, supports and develops applications and servers and specially key, we had the relationship to map the firewall rules.</p>

<p><a href="http://ivan.pedrazas.me/wp-content/uploads/2014/07/networkmap.png"><img class="aligncenter size-large wp-image-289" src="http://ivan.pedrazas.me/wp-content/uploads/2014/07/networkmap-1024x539.png" alt="networkmap" width="700" height="368" /></a></p>

<p>No matter how strict your rules are, you will always have exceptions and you will have to deal with them&#8230; and as in any other place we do, but those exceptions are the first things to get broken when updates or migrations happen.</p>

<p>Things that I&#8217;ve learnt during this process:</p>

<ul>
<li>Creating a graph is much easier that it seems, specially if you run docker.</li>
<li>Data with Relationships visualisations are very powerful. Do not underestimate them!</li>
<li><strong>Having an image of your map is worth a 1000 misunderstandings!</strong></li>
<li>Uploading CSV is a super fast way of getting your data in Neo4j</li>
<li>I love the idea of having a <a href="http://docs.neo4j.org/chunked/milestone/rest-api-cypher.html">REST API</a> for my Cypher queries</li>
<li>Have I said that you can do batch processing with their API? #AWESOME!</li>
</ul>

<p>Let me give you the basic queries you will need to recreate a beautiful map of your network</p>

<p><strong># Creates Application</strong></p>

<pre>CREATE (ee:Application { name: "Google Search Engine", version: "42", public: true })
</pre>

<p><strong># Creates Server</strong></p>

<pre>CREATE (ee:Server { name: "galactus", os: "Linux Debian 7", ip: "192.168.69.70" })
</pre>

<p><strong># Creates Person</strong></p>

<pre>CREATE (ee:Person { name: "John Wayne", email: "jwayne@galactus.net", ext: 6867 })
</pre>

<p><strong># Creates Relationship Person-App, in this case:</strong></p>

<p><strong># person supports application</strong></p>

<pre>MATCH (a:Person),(b:Application)
    WHERE a.name = 'John Wayne' AND b.name = 'Google Search Engine' 
CREATE (a)-[r:Supports]-&gt;(b)
RETURN r
</pre>

<p><strong># Display everything</strong></p>

<pre>MATCH (a)-[r]-(b) RETURN a,b LIMIT 25
</pre>

<p>That&#8217;s all folks, hope you have fun!</p>

<p>Oh, one last thing&#8230; in case you want to run <a href="https://registry.hub.docker.com/u/tpires/neo4j/">Neo4j in docker</a>:</p>

<pre>docker run -d -p 7474:7474 tpires/neo4j</pre>

<p>If you have any comments, you can <a href="https://twitter.com/ipedrazas">find me here <img src="http://ivan.pedrazas.me/wp-includes/images/smilies/icon_smile.gif" alt=":)" class="wp-smiley" /></a></p>

                    </div>
                </section>
                
            </div>
            
<div class="pagination">
  <nav role="pagination" class="post-list-pagination">
      
      <a href="/posts/" class="post-list-pagination-item pure-button post-list-pagination-item-prev">
        <i class="fa fa-angle-double-left"></i>&nbsp;Newer
      </a>
      
    <span class="post-list-pagination-item post-list-pagination-item-current">Page 2 of 6</span>
    
      <a href="/posts/page/3/" class="post-list-pagination-item pure-button post-list-pagination-item-next">
        Older&nbsp;<i class="fa fa-angle-double-right"></i>
      </a>
    
  </nav>
</div>


            <div class="footer">
    <div class="pure-menu pure-menu-horizontal pure-menu-open">
        <ul>
            <li>Powered by <a class="hugo" href="http://hugo.spf13.com/" target="_blank">hugo</a></li>
        </ul>
    </div>
</div>
<script src="http://blog.pedrazas.me/js/all.min.js"></script>
        </div>
    </div>
</div>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', '', 'auto');
ga('send', 'pageview');

</script>

</body>
</html>
